<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiements - Propri√©taire | PNSBIL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/payments.css">
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <span>üè† PNSBIL</span>
                <span>Espace Propri√©taire</span>
            </div>
            <div class="user-menu">
                <span class="user-name" id="userName">M. Mohamed Diallo</span>
                <button class="btn btn-outline" onclick="logout()">D√©connexion</button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="sidebar">
        <div class="nav-section">
            <h3>Gestion Immobili√®re</h3>
            <a href="dashboard.html" class="nav-link">üìä Tableau de bord</a>
            <a href="proprietes.html" class="nav-link">üè† Mes propri√©t√©s</a>
            <a href="baux.html" class="nav-link">üìë Baux locatifs</a>
            <a href="paiements.html" class="nav-link active">üí≥ Paiements</a>
            <a href="impots.html" class="nav-link">üí∞ Imp√¥ts locatifs</a>
        </div>
        
        <div class="nav-section">
            <h3>Communication</h3>
            <a href="communication.html" class="nav-link">üí¨ Messagerie</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-actions">
                <h1>Gestion des Paiements</h1>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newPaymentModal">
                    <i class="fas fa-plus me-2"></i> Enregistrer paiement
                </button>
            </div>
            <p>Suivez et g√©rez tous les paiements de loyers</p>
        </div>

        <!-- Statistiques Propri√©taire -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <h3 class="fw-bold text-primary" id="monthlyRevenue">2.35M FCFA</h3>
                        <p class="text-muted mb-0">Re√ßus ce mois</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <h3 class="fw-bold text-success" id="validatedPayments">6</h3>
                        <p class="text-muted mb-0">Paiements valid√©s</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <h3 class="fw-bold text-warning" id="pendingPayments">2</h3>
                        <p class="text-muted mb-0">En attente</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <h3 class="fw-bold text-danger" id="overduePayments">1</h3>
                        <p class="text-muted mb-0">Retards</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- IA Suggestions pour Propri√©taire -->
        <div class="row g-4 mb-4">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0">
                        <h5 class="card-title mb-0 fw-bold">
                            <i class="fas fa-robot me-2 text-primary"></i>
                            Suggestions Intelligentes
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="ai-suggestion-item">
                            <i class="fas fa-bell text-warning me-3"></i>
                            <div>
                                <strong>Rappel automatique recommand√©</strong>
                                <p class="mb-0 text-muted">Envoyer un rappel √† Mariam Sow pour le loyer de novembre</p>
                            </div>
                            <button class="btn btn-sm btn-outline-warning">Envoyer</button>
                        </div>
                        <div class="ai-suggestion-item mt-3">
                            <i class="fas fa-chart-line text-success me-3"></i>
                            <div>
                                <strong>Tendance positive d√©tect√©e</strong>
                                <p class="mb-0 text-muted">Vos revenus ont augment√© de 12% ce trimestre</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0">
                        <h5 class="card-title mb-0 fw-bold">Pr√©diction IA</h5>
                    </div>
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-2x text-primary mb-3"></i>
                        <h6>Revenus D√©cembre</h6>
                        <div class="fw-bold text-primary" id="revenuePrediction">2.65M FCFA</div>
                        <small class="text-muted">+12% vs novembre</small>
                        <div class="mt-3">
                            <div class="badge bg-success">Confiance: 92%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paiements en Attente - Vue Propri√©taire -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0 fw-bold">Paiements en Attente</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Locataire</th>
                                <th>Propri√©t√©</th>
                                <th>Montant</th>
                                <th>√âch√©ance</th>
                                <th>Jours de retard</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-placeholder bg-warning text-white rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                            MS
                                        </div>
                                        <div>
                                            <div class="fw-bold">Mariam Sow</div>
                                            <small class="text-muted">+221 77 123 45 67</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-bold">Studio C5</div>
                                    <small class="text-muted">Point E, Dakar</small>
                                </td>
                                <td>
                                    <div class="fw-bold text-primary">250,000 FCFA</div>
                                </td>
                                <td>05/11/2024</td>
                                <td>
                                    <span class="badge bg-danger">15 jours</span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary" onclick="sendReminder(1)">
                                            <i class="fas fa-bell me-1"></i> Rappel
                                        </button>
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#paymentModal" 
                                                data-tenant="Mariam Sow" data-amount="250000" data-property="Studio C5">
                                            <i class="fas fa-credit-card me-1"></i> Payer
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Historique des Paiements - Vue Propri√©taire -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0 fw-bold">Historique des Paiements</h5>
                    <div class="d-flex gap-2">
                        <select class="form-select form-select-sm" style="width: auto;">
                            <option>Tous les statuts</option>
                            <option>Valid√©s</option>
                            <option>En attente</option>
                            <option>Annul√©s</option>
                        </select>
                        <input type="month" class="form-control form-control-sm" style="width: auto;" value="2024-11">
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Locataire</th>
                                <th>Propri√©t√©</th>
                                <th>Montant</th>
                                <th>M√©thode</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="fw-bold">PAY-2024-001</div>
                                    <small class="text-muted">Loyer Novembre 2024</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-placeholder bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                            AS
                                        </div>
                                        <div>
                                            <div class="fw-bold">Aminata Sy</div>
                                            <small class="text-muted">Appartement B12</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-bold">Appartement B12</div>
                                    <small class="text-muted">Dakar Plateau</small>
                                </td>
                                <td>
                                    <div class="fw-bold text-primary">450,000 FCFA</div>
                                </td>
                                <td>
                                    <span class="badge bg-warning">
                                        <i class="fas fa-mobile-alt me-1"></i> Orange Money
                                    </span>
                                </td>
                                <td>01/11/2024</td>
                                <td>
                                    <span class="badge bg-success">Valid√©</span>
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Actions
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="viewPaymentDetails(1)"><i class="fas fa-eye me-2"></i> Voir d√©tails</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="generateReceipt(1)"><i class="fas fa-receipt me-2"></i> G√©n√©rer quittance</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="exportPayment(1)"><i class="fas fa-file-export me-2"></i> Exporter</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Nouveau Paiement pour Propri√©taire -->
    <div class="modal fade" id="newPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Enregistrer un Paiement Manuel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="manualPaymentForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Locataire</label>
                                <select class="form-select" required>
                                    <option value="">S√©lectionnez un locataire...</option>
                                    <option value="1">Aminata Sy - Appartement B12</option>
                                    <option value="2">Jean Dupont - Villa 45</option>
                                    <option value="3">Mariam Sow - Studio C5</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type de paiement</label>
                                <select class="form-select" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="loyer">Loyer</option>
                                    <option value="caution">Caution</option>
                                    <option value="charges">Charges</option>
                                    <option value="autre">Autre</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Montant (FCFA)</label>
                                <input type="number" class="form-control" placeholder="Montant" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">M√©thode de paiement</label>
                                <select class="form-select" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="orange_money">Orange Money</option>
                                    <option value="moov_money">Moov Money</option>
                                    <option value="virement">Virement bancaire</option>
                                    <option value="especes">Esp√®ces</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Date du paiement</label>
                                <input type="date" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">R√©f√©rence</label>
                                <input type="text" class="form-control" placeholder="R√©f√©rence du paiement">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" rows="3" placeholder="Notes suppl√©mentaires"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="saveManualPayment()">Enregistrer le paiement</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Paiement S√©curis√© (identique √† votre version) -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <!-- Le contenu du modal de paiement reste identique √† votre version -->
        <!-- ... -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/payments-proprietaire.js"></script>
    <script>
        if (!checkAuth('proprietaire')) {}
        
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (user) {
                document.getElementById('userName').textContent = user.name;
            }
            loadPaymentData();
        });

        function loadPaymentData() {
            // Simulation de chargement des donn√©es
            document.getElementById('monthlyRevenue').textContent = '2.35M FCFA';
            document.getElementById('validatedPayments').textContent = '6';
            document.getElementById('pendingPayments').textContent = '2';
            document.getElementById('overduePayments').textContent = '1';
        }

        function sendReminder(paymentId) {
            alert(`Rappel envoy√© pour le paiement ${paymentId}`);
            // Ici, int√©gration avec l'API d'envoi de notifications
        }

        function viewPaymentDetails(paymentId) {
            alert(`D√©tails du paiement ${paymentId}`);
        }

        function generateReceipt(paymentId) {
            alert(`G√©n√©ration de la quittance pour le paiement ${paymentId}`);
        }

        function exportPayment(paymentId) {
            alert(`Export du paiement ${paymentId}`);
        }

        function saveManualPayment() {
            alert('Paiement manuel enregistr√© avec succ√®s');
            const modal = bootstrap.Modal.getInstance(document.getElementById('newPaymentModal'));
            modal.hide();
        }
    </script>

    <style>
        .avatar-placeholder {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ai-suggestion-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .ai-suggestion-item:not(:last-child) {
            margin-bottom: 0.5rem;
        }

        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        /* Adaptation du CSS de paiement */
        .payment-method-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .payment-method-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .payment-method-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
    </style>

    <!-- Footer -->
    <footer class="bg-dark text-white pt-5 pb-3">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">PNSBIL</h5>
                    <p>Plateforme Nationale de Suivi des Baux et Perception des Imp√¥ts Locatifs</p>
                    <p>Modernisation et digitalisation de la gestion du march√© locatif.</p>
                </div>
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5 class="fw-bold mb-3">Liens rapides</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="index.html" class="text-white-50 text-decoration-none">Accueil</a></li>
                        <li class="mb-2"><a href="properties.html" class="text-white-50 text-decoration-none">Propri√©t√©s</a></li>
                        <li class="mb-2"><a href="leases.html" class="text-white-50 text-decoration-none">Baux</a></li>
                        <li class="mb-2"><a href="taxes.html" class="text-white-50 text-decoration-none">Imp√¥ts</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5 class="fw-bold mb-3">Ressources</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-white-50 text-decoration-none">FAQ</a></li>
                        <li class="mb-2"><a href="#" class="text-white-50 text-decoration-none">Guides</a></li>
                        <li class="mb-2"><a href="#" class="text-white-50 text-decoration-none">Contact</a></li>
                        <li class="mb-2"><a href="#" class="text-white-50 text-decoration-none">Mentions l√©gales</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4 mb-4">
                    <h5 class="fw-bold mb-3">Contact</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-map-marker-alt me-2"></i> Avenue XXXXX, Dakar, S√©n√©gal</li>
                        <li class="mb-2"><i class="fas fa-phone me-2"></i> +221 33 123 45 67</li>
                        <li class="mb-2"><i class="fas fa-envelope me-2"></i> contact@pnsbil.sn</li>
                    </ul>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 PNSBIL - Tous droits r√©serv√©s</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
</body>
</html>