<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Paiements - Locataire | PNSBIL</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/pages/locataires-paiements.css">
</head>
<body class="dashboard-page">
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <span>🏠 PNSBIL</span>
                <span>Espace Locataire</span>
            </div>
            <div class="user-menu">
                <span class="user-name" id="userName">Mme Aminata Sy</span>
                <button class="btn btn-outline" onclick="logout()">Déconnexion</button>
            </div>
        </div>
    </header>

    <nav class="sidebar">
        <div class="nav-section">
            <h3>Mon Logement</h3>
            <a href="dashboard.html" class="nav-link">📊 Tableau de bord</a>
            <a href="mes-contrats.html" class="nav-link">📑 Mes contrats</a>
            <a href="paiements.html" class="nav-link active">💳 Mes paiements</a>
            <a href="maintenance.html" class="nav-link">🔧 Maintenance</a>
        </div>
        
        <div class="nav-section">
            <h3>Communication</h3>
            <a href="communication.html" class="nav-link">💬 Messagerie</a>
        </div>
        <div class="nav-section">
            <h3>Recherche</h3>
            <a href="recherche.html" class="nav-link">🔍 Trouver un logement</a>
        </div>
    </nav>

    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-actions">
                <h1>Mes Paiements</h1>
                <button class="btn btn-primary btn-lg" onclick="openPaymentModal()">
                    <i class="fas fa-credit-card"></i> Payer mon loyer
                </button>
            </div>
            <p>Gérez vos paiements de loyer en toute sécurité</p>
        </div>

        <!-- Statistiques Locataire -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 class="text-primary">450,000 FCFA</h3>
                <p>Loyer mensuel</p>
            </div>
            <div class="stat-card">
                <h3 class="text-success">24</h3>
                <p>Paiements effectués</p>
            </div>
            <div class="stat-card">
                <h3 class="text-warning">05/12/2025</h3>
                <p>Prochain paiement</p>
            </div>
            <div class="stat-card">
                <h3 class="text-success">100%</h3>
                <p>Ponctualité</p>
            </div>
        </div>

        <!-- IA Suggestions pour Locataire -->
        <div class="ai-suggestions">
            <div class="ai-card">
                <div class="ai-card-header">
                    <i class="fas fa-robot me-2 text-primary"></i>
                    <h5>Conseils Intelligents</h5>
                </div>
                <div class="ai-suggestion-item">
                    <i class="fas fa-piggy-bank text-info"></i>
                    <div class="ai-suggestion-content">
                        <strong>Économisez 5% sur votre loyer</strong>
                        <p>Payer avant le 28 novembre pour bénéficier d'une réduction</p>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="openPaymentModal()">Payer maintenant</button>
                </div>
                <div class="ai-suggestion-item">
                    <i class="fas fa-calendar-check text-success"></i>
                    <div class="ai-suggestion-content">
                        <strong>Paiement automatique recommandé</strong>
                        <p>Activez le prélèvement automatique pour plus de tranquillité</p>
                    </div>
                    <button class="btn btn-sm btn-outline-success" onclick="setupAutoPayment()">Activer</button>
                </div>
            </div>
            <div class="ai-card prediction-card">
                <div class="ai-card-header">
                    <h5>Prédiction IA</h5>
                </div>
                <div>
                    <i class="fas fa-chart-line"></i>
                    <h6>Meilleur moment pour payer</h6>
                    <div class="prediction-date">28/11/2025</div>
                    <small class="text-muted">Pour éviter les retards</small>
                    <div class="mt-3">
                        <div class="badge bg-success">Économie: 22,500 FCFA</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paiement en Cours -->
        <div class="current-payment">
            <div class="current-payment-header">
                <h5>Paiement du Mois</h5>
            </div>
            <div class="payment-details">
                <div class="payment-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="payment-info">
                    <h4>Appartement B12</h4>
                    <p>Ouagadougou Plateau - Loyer de novembre 2025</p>
                    <div class="payment-meta">
                        <div class="meta-item">
                            <small>Montant</small>
                            <div class="amount">450,000 FCFA</div>
                        </div>
                        <div class="meta-item">
                            <small>Échéance</small>
                            <div class="value">05/12/2025</div>
                        </div>
                        <div class="meta-item">
                            <small>Statut</small>
                            <div class="payment-status bg-warning">En attente</div>
                        </div>
                    </div>
                </div>
                <div class="payment-actions">
                    <button class="btn btn-primary btn-lg" onclick="openPaymentModal()">
                        <i class="fas fa-credit-card"></i> Payer maintenant
                    </button>
                </div>
            </div>
        </div>

        <!-- Historique des Paiements -->
        <div class="payment-history">
            <div class="payment-history-header">
                <h5>Historique de Mes Paiements</h5>
            </div>
            <div class="table-responsive">
                <table class="payment-table">
                    <thead>
                        <tr>
                            <th>Période</th>
                            <th>Montant</th>
                            <th>Méthode</th>
                            <th>Date de paiement</th>
                            <th>Statut</th>
                            <th>Reçu</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="payment-period">
                                    <span class="period">Octobre 2025</span>
                                    <span class="description">Loyer mensuel</span>
                                </div>
                            </td>
                            <td>
                                <div class="payment-amount">450,000 FCFA</div>
                            </td>
                            <td>
                                <span class="payment-method bg-warning">
                                    <i class="fas fa-mobile-alt"></i> Orange Money
                                </span>
                            </td>
                            <td>01/10/2025</td>
                            <td>
                                <span class="payment-status bg-success">Validé</span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="downloadReceipt(1)">
                                    <i class="fas fa-download"></i> Télécharger
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="payment-period">
                                    <span class="period">Septembre 2025</span>
                                    <span class="description">Loyer mensuel</span>
                                </div>
                            </td>
                            <td>
                                <div class="payment-amount">450,000 FCFA</div>
                            </td>
                            <td>
                                <span class="payment-method bg-primary">
                                    <i class="fas fa-mobile-alt"></i> Moov Money
                                </span>
                            </td>
                            <td>02/09/2025</td>
                            <td>
                                <span class="payment-status bg-success">Validé</span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="downloadReceipt(2)">
                                    <i class="fas fa-download"></i> Télécharger
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Modal de Paiement -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Paiement Sécurisé</h3>
                <button class="close-modal" onclick="closePaymentModal()">&times;</button>
            </div>
            <div id="modalContent">
                <div>
                    <div>
                        <h4>Détails du paiement</h4>
                        <div class="modal-payment-details">
                            <div class="payment-detail-row">
                                <span>Locataire:</span>
                                <strong>Aminata Sy</strong>
                            </div>
                            <div class="payment-detail-row">
                                <span>Logement:</span>
                                <strong>Appartement B12</strong>
                            </div>
                            <div class="payment-detail-row">
                                <span>Montant:</span>
                                <strong class="payment-amount">450,000 FCFA</strong>
                            </div>
                            <div class="payment-detail-row">
                                <span>Période:</span>
                                <strong>Novembre 2025</strong>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4>Méthode de paiement</h4>
                        <div class="payment-methods">
                            <div class="renewal-option" onclick="selectPaymentMethod('orange')">
                                <input type="radio" id="orange-money" name="payment-method" value="orange">
                                <label for="orange-money">Orange Money</label>
                            </div>
                            <div class="renewal-option" onclick="selectPaymentMethod('moov')">
                                <input type="radio" id="moov-money" name="payment-method" value="moov">
                                <label for="moov-money">Moov Money</label>
                            </div>
                            <div class="renewal-option" onclick="selectPaymentMethod('wave')">
                                <input type="radio" id="wave" name="payment-method" value="wave">
                                <label for="wave">Wave</label>
                            </div>
                        </div>
                    </div>

                    <div id="paymentDetails" class="payment-details-section">
                        <h4>Détails du paiement mobile</h4>
                        <div class="payment-details-box">
                            <p>Veuillez effectuer le paiement vers:</p>
                            <div class="payment-phone">
                                +226 70 123 45 67
                            </div>
                            <p class="text-muted">Référence: PNSBIL-NOV2025-001</p>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="btn btn-outline" onclick="closePaymentModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="processPayment()" id="payButton" disabled>
                            <i class="fas fa-lock"></i> Payer maintenant
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div>
                    <h5>PNSBIL</h5>
                    <p>Plateforme Nationale de Suivi des Baux et Perception des Impôts Locatifs</p>
                    <p>Modernisation et digitalisation de la gestion du marché locatif.</p>
                </div>
                <div>
                    <h5>Liens rapides</h5>
                    <ul>
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="properties.html">Propriétés</a></li>
                        <li><a href="leases.html">Baux</a></li>
                        <li><a href="taxes.html">Impôts</a></li>
                    </ul>
                </div>
                <div>
                    <h5>Ressources</h5>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Guides</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Mentions légales</a></li>
                    </ul>
                </div>
                <div>
                    <h5>Contact</h5>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Avenue XXXXX, Ouagadougou, Burkina Faso</li>
                        <li><i class="fas fa-phone"></i> +226 33 123 45 67</li>
                        <li><i class="fas fa-envelope"></i> contact@pnsbil.sn</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 PNSBIL - Tous droits réservés</p>
            </div>
        </div>
    </footer>

    <script>
        // Gestionnaire de Paiements - JavaScript Fonctionnel
        class PaymentManager {
            constructor() {
                this.payments = [];
                this.currentPayment = null;
                this.selectedMethod = null;
                this.init();
            }

            init() {
                this.loadPayments();
                this.setupEventListeners();
                this.updatePaymentStats();
            }

            loadPayments() {
                // Simulation de données de paiement
                this.payments = [
                    {
                        id: 1,
                        period: "Octobre 2025",
                        description: "Loyer mensuel",
                        amount: 450000,
                        method: "orange",
                        methodLabel: "Orange Money",
                        date: "2025-10-01",
                        status: "validated",
                        receipt: true
                    },
                    {
                        id: 2,
                        period: "Septembre 2025",
                        description: "Loyer mensuel",
                        amount: 450000,
                        method: "moov",
                        methodLabel: "Moov Money",
                        date: "2025-09-02",
                        status: "validated",
                        receipt: true
                    },
                    {
                        id: 3,
                        period: "Août 2025",
                        description: "Loyer mensuel",
                        amount: 450000,
                        method: "wave",
                        methodLabel: "Wave",
                        date: "2025-08-01",
                        status: "validated",
                        receipt: true
                    }
                ];

                this.currentPayment = {
                    period: "Novembre 2025",
                    amount: 450000,
                    dueDate: "2025-12-05",
                    status: "pending"
                };

                this.renderPaymentHistory();
            }

            renderPaymentHistory() {
                // L'historique est déjà rendu en HTML statique
                // Cette méthode pourrait être utilisée pour le rendu dynamique
            }

            updatePaymentStats() {
                // Mise à jour des statistiques en temps réel
                const totalPayments = this.payments.length;
                const onTimeRate = this.calculateOnTimeRate();
                
                // Mise à jour de l'interface si nécessaire
                console.log('Statistiques mises à jour:', { totalPayments, onTimeRate });
            }

            calculateOnTimeRate() {
                // Calcul du taux de ponctualité
                const onTimePayments = this.payments.filter(p => 
                    new Date(p.date).getDate() <= 5 // Paiement avant le 5 du mois
                ).length;
                
                return (onTimePayments / this.payments.length) * 100;
            }

            setupEventListeners() {
                // Gestion des sélections de méthode de paiement
                document.querySelectorAll('.renewal-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const radio = option.querySelector('input[type="radio"]');
                        radio.checked = true;
                        this.selectPaymentMethod(radio.value);
                    });
                });
            }

            openPaymentModal() {
                document.getElementById('paymentModal').style.display = 'flex';
                this.resetPaymentForm();
            }

            closePaymentModal() {
                document.getElementById('paymentModal').style.display = 'none';
                this.resetPaymentForm();
            }

            resetPaymentForm() {
                this.selectedMethod = null;
                document.querySelectorAll('input[name="payment-method"]').forEach(radio => {
                    radio.checked = false;
                });
                document.getElementById('paymentDetails').style.display = 'none';
                document.getElementById('payButton').disabled = true;
                
                document.querySelectorAll('.renewal-option').forEach(opt => {
                    opt.style.borderColor = 'var(--border-color)';
                });
            }

            selectPaymentMethod(method) {
                this.selectedMethod = method;
                document.getElementById('paymentDetails').style.display = 'block';
                document.getElementById('payButton').disabled = false;
                
                // Feedback visuel
                document.querySelectorAll('.renewal-option').forEach(opt => {
                    opt.style.borderColor = 'var(--border-color)';
                });
                
                const selectedOption = document.querySelector(`input[value="${method}"]`).parentElement;
                selectedOption.style.borderColor = 'var(--primary-color)';
            }

            processPayment() {
                if (!this.selectedMethod) {
                    this.showNotification('Veuillez sélectionner une méthode de paiement', 'error');
                    return;
                }

                this.showLoading('Traitement du paiement...');

                // Simulation de traitement de paiement
                setTimeout(() => {
                    this.hideLoading();
                    
                    // Simulation de succès
                    if (Math.random() > 0.1) { // 90% de succès
                        this.showNotification('Paiement effectué avec succès !', 'success');
                        this.closePaymentModal();
                        
                        // Mettre à jour l'interface
                        this.updatePaymentStatus();
                    } else {
                        this.showNotification('Échec du paiement. Veuillez réessayer.', 'error');
                    }
                }, 3000);
            }

            updatePaymentStatus() {
                // Mettre à jour le statut du paiement courant
                const statusElement = document.querySelector('.current-payment .payment-status');
                if (statusElement) {
                    statusElement.textContent = 'Payé';
                    statusElement.className = 'payment-status bg-success';
                }
                
                // Désactiver le bouton de paiement
                const payButton = document.querySelector('.current-payment .btn-primary');
                if (payButton) {
                    payButton.disabled = true;
                    payButton.innerHTML = '<i class="fas fa-check"></i> Payé';
                    payButton.style.background = 'var(--success-color)';
                }
            }

            setupAutoPayment() {
                this.showLoading('Configuration du paiement automatique...');
                
                setTimeout(() => {
                    this.hideLoading();
                    this.showNotification('Paiement automatique configuré avec succès !', 'success');
                }, 2000);
            }

            downloadReceipt(paymentId) {
                this.showLoading('Génération du reçu...');
                
                setTimeout(() => {
                    this.hideLoading();
                    
                    const payment = this.payments.find(p => p.id === paymentId);
                    if (payment) {
                        this.showNotification(`Reçu ${payment.period} téléchargé`, 'success');
                        
                        // Simulation de téléchargement
                        const link = document.createElement('a');
                        link.href = '#';
                        link.download = `quittance-${payment.period.toLowerCase().replace(' ', '-')}.pdf`;
                        link.click();
                    }
                }, 1500);
            }

            logout() {
                if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                    this.showLoading('Déconnexion en cours...');
                    
                    setTimeout(() => {
                        this.hideLoading();
                        this.showNotification('Déconnexion réussie', 'success');
                        
                        setTimeout(() => {
                            window.location.href = '../login.html';
                        }, 1000);
                    }, 1500);
                }
            }

            // Utilitaires
            showLoading(message = 'Chargement...') {
                let loader = document.getElementById('global-loader');
                if (!loader) {
                    loader = document.createElement('div');
                    loader.id = 'global-loader';
                    loader.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.5);
                        backdrop-filter: blur(4px);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                    `;
                    document.body.appendChild(loader);
                }
                
                loader.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 12px; color: var(--text-primary); display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                        <div class="loader-spinner" style="width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #2563eb; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span>${message}</span>
                    </div>
                `;
                loader.style.display = 'flex';
            }

            hideLoading() {
                const loader = document.getElementById('global-loader');
                if (loader) {
                    loader.style.display = 'none';
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: white;
                    padding: 1rem 1.5rem;
                    border-radius: 12px;
                    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
                    border-left: 4px solid ${this.getNotificationColor(type)};
                    transform: translateX(400px);
                    transition: transform 0.3s ease;
                    z-index: 10000;
                    max-width: 400px;
                `;

                const icons = {
                    'success': 'check-circle',
                    'error': 'exclamation-triangle',
                    'warning': 'exclamation-circle',
                    'info': 'info-circle'
                };

                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-${icons[type]}" style="color: ${this.getNotificationColor(type)}; font-size: 1.25rem;"></i>
                        <span>${message}</span>
                    </div>
                `;

                document.body.appendChild(notification);

                // Animation d'entrée
                setTimeout(() => notification.style.transform = 'translateX(0)', 100);

                // Supprimer après 4 secondes
                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }

            getNotificationColor(type) {
                const colors = {
                    'success': '#10b981',
                    'error': '#ef4444',
                    'warning': '#f59e0b',
                    'info': '#3b82f6'
                };
                return colors[type] || '#3b82f6';
            }
        }

        // Initialisation
        const paymentManager = new PaymentManager();

        // Fonctions globales pour compatibilité HTML
        function openPaymentModal() { paymentManager.openPaymentModal(); }
        function closePaymentModal() { paymentManager.closePaymentModal(); }
        function selectPaymentMethod(method) { paymentManager.selectPaymentMethod(method); }
        function processPayment() { paymentManager.processPayment(); }
        function setupAutoPayment() { paymentManager.setupAutoPayment(); }
        function downloadReceipt(id) { paymentManager.downloadReceipt(id); }
        function logout() { paymentManager.logout(); }

        // Animation CSS pour le spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // Fermer le modal en cliquant à l'extérieur
        document.getElementById('paymentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                paymentManager.closePaymentModal();
            }
        });
    </script>
</body>
</html>